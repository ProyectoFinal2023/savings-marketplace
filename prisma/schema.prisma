generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model User {
  id                String              @id
  addressId         String?             @unique
  userTypeId        String
  birthdate         DateTime?
  cuit              String?             @db.VarChar(11)
  tutorialDone      Boolean             @default(false)
  tutorialStep      Int                 @default(1)
  clerkId           String?
  email             String?
  name              String?
  phone             String?
  surname           String?
  address           Address?            @relation(fields: [addressId], references: [id])
  userType          UserType            @relation(fields: [userTypeId], references: [id])
  userInSavingsPlan UserInSavingsPlan[]
  cars              Car[]

  @@map("users")
}

model UserType {
  id          String   @id @default(cuid())
  createdAt   DateTime @default(now())
  description String   @unique
  users       User[]

  @@map("user_types")
}

model UserInSavingsPlan {
  id          String           @id @default(cuid())
  planId      String
  userId      String
  user        User             @relation(fields: [userId], references: [id])
  savingsPlan SavingsPlan      @relation(fields: [planId], references: [id])
  invoices    PaymentInvoice[]

  @@unique([planId, userId], map: "plan_id_user_id_unique")
  @@unique([userId, planId])
  @@index([userId])
  @@map("savings_plans_users")
}

model SavingsPlan {
  id                String              @id @default(cuid())
  statusId          String
  portfolioId       String
  title             String
  description       String
  plan_months       Int
  plan_total_months Int
  paymentMethodId   String
  startDate         DateTime
  endDate           DateTime
  carModelId        String
  movingValue       Int
  status            SavingsPlanStatus   @relation(fields: [statusId], references: [id])
  usersInPlan       UserInSavingsPlan[]
  portfolio         Portfolio           @relation(fields: [portfolioId], references: [id])
  paymentMethod     PaymentMethod       @relation(fields: [paymentMethodId], references: [id])
  carModel          CarModel            @relation(fields: [carModelId], references: [id])

  @@index([statusId])
  @@index([paymentMethodId])
  @@index([portfolioId])
  @@index([carModelId])
  @@map("savings_plans")
}

model PaymentInvoice {
  id                String            @id @default(cuid())
  createdAt         DateTime          @default(now())
  planId            String
  userId            String
  paymentMethodId   String
  amountArs         Decimal           @db.Decimal(10, 0)
  paymentDate       DateTime
  installmentNumber Int
  userInSavingsPlan UserInSavingsPlan @relation(fields: [userId, planId], references: [userId, planId])
  paymentMethod     PaymentMethod     @relation(fields: [paymentMethodId], references: [id])

  @@index([paymentMethodId])
  @@index([userId, planId])
  @@map("payment_invoices")
}

model PaymentMethod {
  id           String           @id @default(cuid())
  createdAt    DateTime         @default(now())
  description  String           @unique(map: "payment_method_description_unique")
  invoices     PaymentInvoice[]
  savingsPlans SavingsPlan[]

  @@map("payment_methods")
}

model SavingsPlanStatus {
  id           String        @id @default(cuid())
  description  String        @unique(map: "savings_plan_status_description_unique")
  savingsPlans SavingsPlan[]

  @@map("savings_plan_status")
}

model Car {
  id         String     @id @default(cuid())
  plate      String     @unique(map: "car_plate_unique")
  userId     String
  is_awarded Boolean
  is_drawn   Boolean
  carModelId String
  user       User       @relation(fields: [userId], references: [id])
  carPhoto   CarPhoto[]
  carModel   CarModel   @relation(fields: [carModelId], references: [id])

  @@index([userId])
  @@index([carModelId])
  @@map("cars")
}

model CarModel {
  id           String        @id @default(cuid())
  description  String        @unique(map: "car_model_description_unique")
  amountDoors  Int           @default(4)
  carPhotos    CarPhoto[]
  savingsPlans SavingsPlan[]
  cars         Car[]
  carAttributes Json?

  @@map("car_models")
}

model CarPhoto {
  id         String    @id @default(cuid())
  url        String    @db.Text
  epigraph   String?   @db.Text
  carId      String?
  carModelId String?
  car        Car?      @relation(fields: [carId], references: [id])
  carModel   CarModel? @relation(fields: [carModelId], references: [id])

  @@index([carId])
  @@index([carModelId])
  @@map("car_photos")
}

model Portfolio {
  id              String         @id @default(cuid())
  createdAt       DateTime       @default(now())
  carDealershipId String?
  automotiveId    String?
  carDealership   CarDealership? @relation(fields: [carDealershipId], references: [id])
  automotive      Automotive?    @relation(fields: [automotiveId], references: [id])
  savingsPlans    SavingsPlan[]

  @@index([carDealershipId])
  @@index([automotiveId])
  @@map("portfolios")
}

model CarDealership {
  id          String      @id @default(cuid())
  description String      @db.Text
  addressId   String
  cuit        String      @db.VarChar(11)
  code        Int
  address     Address     @relation(fields: [addressId], references: [id])
  portfolios  Portfolio[]

  @@index([addressId])
  @@map("car_dealerships")
}

model Automotive {
  id          String      @id @default(cuid())
  description String      @db.Text
  logo        String      @db.Text
  createdAt   DateTime    @default(now())
  addressId   String
  address     Address     @relation(fields: [addressId], references: [id])
  portfolios  Portfolio[]

  @@index([addressId])
  @@map("automotives")
}

model Address {
  id             String          @id @default(cuid())
  street         String
  streetNumber   Int?
  province       String
  city           String
  district       String
  postalCode     Int
  additionalData String?
  users          User[]
  carDealerships CarDealership[]
  automotives    Automotive[]

  @@map("addresses")
}

model Guarantors {
  id        Int     @id @default(autoincrement())
  userId    String
  name      String
  surname   String
  phone     String
  email     String
  cuit      String
  addressId String?

  @@index([addressId])
  @@index([userId])
}
